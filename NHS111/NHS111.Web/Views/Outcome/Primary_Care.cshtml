@using NHS111.Models.Models.Web
@inherits NHS111.Web.Views.Shared.SurveyLinkView<OutcomeViewModel>
@{
    ViewBag.Title = "Primary_care";
    Layout = "~/Views/Shared/_LayoutNhsUK.cshtml";
    var nonUrgentDxCodes = new[] {"Dx09", "Dx10", "Dx16", "Dx75"};
    var isUrgent = !nonUrgentDxCodes.Contains(Model.Id);
    var outcomeHeaderText = isUrgent ?  "Contact your GP now" : "Book a non-urgent GP appointment";
    var hasDosResults = !Model.DosCheckCapacitySummaryResult.ResultListEmpty;
}
@section HeadTop {
    @{ var url = string.Format("/outcome/{0}/{1}/{2}/disposition/", Url.Encode(Model.PathwayNo), Url.Encode(Model.OutcomeGroup.Text), Url.Encode(Model.Id)); }
    <script>
        var pageId = '@Model.Id';
        dataLayer = [
        {
            'virtualPageUrl': '@url',
            'virtualPageTitle': '@Model.DispositionText'
        }];
    </script>
}
@section Title { NHS 111 - Primary care }
@section FeedbackSection {
    @if (SurveyLinkFeature.IsEnabled)
    {
        @Html.Partial("_SurveyLink", Model.SurveyLink)
    }
}

<section class="measure nhsuk-core">
    <div class="callout callout--attention">
        <h1 class="nhsuk-heading-l">@outcomeHeaderText </h1>
    </div>

    @{ if (hasDosResults || !isUrgent) {
            <ul>
                @{ if (isUrgent) {
                   <li>
                       @using (Html.BeginForm("ServiceList", "Outcome", FormMethod.Post)) {
                           @Html.Partial("_CommonHiddenFieldsOutcomeViewModel", Model, new ViewDataDictionary() { TemplateInfo = new TemplateInfo() {HtmlFieldPrefix = "FindService" } } )
                           @Html.Partial("_CommonHiddenFieldsCareAdviceViewModel", Model, new ViewDataDictionary() { TemplateInfo = new TemplateInfo() {HtmlFieldPrefix = "FindService" } } )
                           <button class="button--link" id="cant-book-appt" type="submit" value="CantBookAppt" name="CantBookAppt" formnovalidate>I can't get an appointment today</button>
                       }
                   </li>
                }}
                <li>
                    @using (Html.BeginForm("ServiceList", "Outcome", FormMethod.Post)) {
                        @Html.Partial("_CommonHiddenFieldsOutcomeViewModel", Model, new ViewDataDictionary() { TemplateInfo = new TemplateInfo() {HtmlFieldPrefix = "FindService" } } )
                        @Html.Partial("_CommonHiddenFieldsCareAdviceViewModel", Model, new ViewDataDictionary() { TemplateInfo = new TemplateInfo() {HtmlFieldPrefix = "FindService" } } )
                        <button class="button--link" id="away-from-home" type="submit" value="AwayFromHome" name="AwayFromHome" formnovalidate>I'm away from home</button>
                    }
                </li>
                
                <li>
                    @using (Html.BeginForm("MoreInfo", "Outcome", FormMethod.Post)) {
                        @Html.Partial("_CommonHiddenFieldsOutcomeViewModel", Model)
                        @Html.Partial("_CommonHiddenFieldsCareAdviceViewModel", Model)

                        <button class="button--link" id="no-gp" type="submit" value="NoGP" name="NoGP" formnovalidate>I don't have a GP</button>
                    }
                </li>
            </ul>
        } else {
           <details class="measure">
               <summary><span class="details__arrow" role="presentation"></span>I don't have a GP</summary>
               <div><p>Find out <a href="https://www.nhs.uk/using-the-nhs/nhs-services/gps/how-to-register-with-a-gp-practice/">how to register with a GP</a> if you don't already have one.</p></div>
           </details>

            <hr role="presentation" class="nhsuk-u-margin-top-6" />
            @Html.Partial("_rs_ChangePostcodeLink", Model, new ViewDataDictionary() { { "ChangeLocationPrefixText", "You've told us you're in " }})
        }
    }
    <hr role="presentation" class="nhsuk-u-margin-top-6" />

    @Html.Partial("_rs_CareAdvice", Model.CareAdvices)
    @Html.Partial("_rs_WorseningAdvice", Model)

</section>


