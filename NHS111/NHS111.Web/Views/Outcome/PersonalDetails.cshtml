@using NHS111.Models.Models.Web
@using NHS111.Models.Models.Web.ITK
@inherits NHS111.Web.Views.Shared.SurveyLinkView<OutcomeViewModel>
@{
    Layout = "~/Views/Shared/_LayoutNhsUk.cshtml";
}

@section Title {
    Enter Personal Details
}

@section HeadTop {
    @{ var url = string.Format("/outcome/{0}/{1}/{2}/itk/personaldetails/{3}/{4}", Url.Encode(Model.PathwayNo), Url.Encode(Model.OutcomeGroup.Text), Url.Encode(Model.Id), Url.Encode(Model.SelectedServiceId), Url.Encode(Model.SelectedService.Name)); }
    <script>
        var pageId = '@Model.Id';
        dataLayer = [
        {
            'virtualPageUrl': '@url',
            'virtualPageTitle': '@Model.TitleWithoutBullets'
        }];
    </script>
}

<link href="~/content/css_NhsUk/personaldetails.css" media="screen" rel="stylesheet" type="text/css" />
<link href="~/content/css_NhsUk/service.css" media="screen" rel="stylesheet" type="text/css" />

@{
    var dataDictionary = ViewContext.ViewData;
    dataDictionary.Add(new KeyValuePair<string, object>("LaunchPage", "personal-details"));
}
@section SurveyBanner{
    @Html.Partial("_SurveyLink", Model.SurveyLink, dataDictionary)
}
@section FeedbackSection {
    @if (!SurveyLinkFeature.IsEnabled)
    {
        @Html.Partial("_FeedbackDetails", new FeedbackViewModel() { PageId = Model.Id });
    }
}

@using (Html.BeginForm("Confirmation", "Outcome", FormMethod.Post, new { id = "personalDetailForm" }))
{
    @Html.Partial("_CommonHiddenFieldsOutcomeViewModel", Model)
    @Html.Partial("_CommonHiddenFieldsCareAdviceViewModel", Model)
    @Html.HiddenFor(m => m.SelectedServiceId)
    
    @Html.Partial("_PersonalDetailsSelf", Model, dataDictionary)
    
    <label for="Informant" class="informant informant-label">
        <span class="informant-radio">
           @Html.CheckBoxFor(m => m.Informant.IsInformant, new { @id = "Informant" })
        </span>
        <span class="informant-text">Did you complete the questions on behalf of the person above?</span>
    </label>

    @Html.Partial("_InformantDetails", Model.Informant, dataDictionary)

    <div class="inline-details">
        <p class="submit-details-disclaimer">
            By clicking Submit my details, you agree to share your information with other NHS organisations.
            See our @Html.ActionLink("privacy policy", "Privacy", "Help", null, new {target = "_blank"}) for more information.
        </p>
        <input type="submit" class="button button-submit-details" value="Submit my details" id="submitDetails"/>
    </div>

    @Html.Partial("_PageLoadingIndicator")                    }

<script type="text/javascript">
    $(document).ready(function () {
        stopPageLoadingIndicator();
        $("#informant-details").hide();
    });

    $('#submitDetails').css('cursor', 'pointer');
    $(document).on('click', '#submitDetails', function (event) {
        if ($("#personalDetailForm").valid()) startPageLoadingIndicator('Contacting your selected service...');
    });

    $(document).on('click', '#Informant', function () {
        $("#informant-details").toggle();
    });

    window.onpageshow = function (event) {
        stopPageLoadingIndicator();
    };
</script>