@using System.Reflection
@using NHS111.Models.Models.Web
@{ Layout = "~/Views/Shared/_LayoutNhsUk.cshtml"; }
@inherits NHS111.Web.Views.Shared.DirectLinkingView<JourneyViewModel>

<link href="~/content/css_NhsUk/question.css?@Assembly.GetCallingAssembly().GetName().Version.ToString()" media="screen" rel="stylesheet" type="text/css" />

@section Title {}

@section Scripts {
    <script>
        var pageId = '@Model.Id';
        dataLayer = [
        {
            'virtualPageUrl': document.location.pathname + '/' + pageId,
            'virtualPageTitle': '@Model.TitleWithoutBullets'
            }
        ];
    </script>
    <style>
        .hideOption {
            display:none;
        }
    </style>
}

@section OuterSection {}

@section FeedbackSection {
    @Html.Partial("_FeedbackDetails", new FeedbackViewModel() { PageId = Request.Url.GetComponents(UriComponents.PathAndQuery, UriFormat.SafeUnescaped) + Model.PathwayId })
}

@using (Html.BeginForm("InitialQuestion", "Question", FormMethod.Post))
{
    @Html.HiddenFor(x => Model.SessionId)
    @Html.HiddenFor(x => Model.Id)
    @Html.HiddenFor(x => Model.JourneyJson)
    @Html.HiddenFor(x => Model.PathwayId)
    @Html.HiddenFor(x => Model.PathwayNo)
    @Html.HiddenFor(x => Model.PathwayTitle)
    @Html.HiddenFor(x => Model.UserInfo.Age)
    @Html.HiddenFor(x => Model.UserInfo.Gender)
    @Html.HiddenFor(x => Model.Title)
    @Html.HiddenFor(x => Model.SymptomDiscriminatorCode)
    @Html.HiddenFor(x => Model.QuestionNo)
    @Html.HiddenFor(x => Model.StateJson)

    @Html.HiddenFor(x => Model.PreviousStateJson)

    <h2 class="heading-large">Do any of these apply?</h2>
    foreach (var bullet in Model.Bullets)
    {
        <span class="red">@bullet</span>
    }

    <div class="question-rationale">
        <h2 class="heading-small">Why are we asking this?</h2>
        <p>Before we ask about the symptoms, we need to check it's not an emergency. If any of these apply, <strong>call 999 now</strong></p>
    </div>

    <div id="answers">
        @foreach (var answer in Model.OrderedAnswers())
        {

            <label for="@answer.TitleWithoutSpaces" class="answer answer-label">
                <span class="answer-text">@answer.Title</span>
            </label>

            if (!String.IsNullOrWhiteSpace(answer.SupportingInformation))
            {
                <div class="help-text">
                    <span class="supporting-info-text"><a class="help-text-link" href="javascript:void(0);">What does this mean?</a></span>
                </div>
            }

            if (!String.IsNullOrWhiteSpace(answer.SupportingInformationHtml))
            {
                <div class="help-text-link-message">@Html.Raw(answer.SupportingInformationHtml)</div>
            }
        }
    </div>
    <hr/>
    <div class="answer answer-label">If none of these apply, click next to continue</div>

    <button class="button button-next" id="nextScreen" type="submit" name="Question" value="Question">Next</button>
}
<script type="text/javascript">
    $(document).ready(function () {
        //enable / disable submit button
        /*if (!($("form input[type=checkbox]").is(':checked'))) {
            $("#nextScreen[type=submit]").attr('disabled', 'disabled');
        }*/

        $("form input[type=checkbox]").change(function () {
            if (($(this).is(':checked'))) {
                $("#nextScreen[type=submit]").removeAttr('disabled');
            } else {
                $("#nextScreen[type=submit]").attr('disabled', 'disabled');
            }

            //make 'none of the above' mutually exclusive
            if ($(this).attr("noneoption") === "false") {
                $("input[type=checkbox][noneoption=true]").attr("checked", false);
            }
            else if ($(this).attr("noneoption") === "true") {
                $("input[type=checkbox][noneoption=false]").attr("checked", false);
            }
        });

        $('.help-text-link').click(function () {
            var $this = $(this);

            var $helpTextLinkMessage = $this.parent().parent().next('.help-text-link-message');
            $helpTextLinkMessage.slideToggle("fast");
        });

    });


</script>