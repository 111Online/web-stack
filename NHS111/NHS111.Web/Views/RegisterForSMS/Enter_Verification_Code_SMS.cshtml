@using NHS111.Models.Models.Web
@inherits NHS111.Web.Views.Shared.SurveyLinkView<SendSmsOutcomeViewModel>
@{
    Layout = "~/Views/Shared/_LayoutNhsUk.cshtml";
}

@section Title {
    NHS 111 - Thanks for providing your details
}

@section HeadTop {
    @{ var url = string.Format("/outcome/{0}/{1}/{2}/disposition/", Url.Encode(Model.PathwayNo), Url.Encode(Model.OutcomeGroup.Text), Url.Encode(Model.Id)); }
    <script>
        var pageId = '@Model.Id';
        dataLayer = [
            {
                'virtualPageUrl': '@url',
                'virtualPageTitle': '@Model.TitleWithoutBullets'
            }];
    </script>
}

<div class="nhsuk-core measure">
    <h1 class="nhsuk-heading-l">Enter your security code</h1>

    <p>This will be a 6-digit number.</p>

    @using (Html.BeginForm("SubmitSMSSecurityCode", "RegisterForSMS", FormMethod.Post, new { id = "submitDetailsForm" }))
    {
        @Html.Partial("_CommonHiddenFieldsOutcomeViewModel", Model)
        @Html.Partial("_CommonHiddenFieldsCareAdviceViewModel", Model)
        @Html.Partial("_commonHiddenFieldsSendsSMSViewModel", Model)
        @Html.HiddenFor(m => m.SelectedServiceId)

        <div class="inline-details form-group @(ViewData.ModelState.IsValid ? "" : "form-group-error")">
            @Html.ValidationMessageFor(m => m.VerificationCodeInput)
            @Html.TextBoxFor(m => m.VerificationCodeInput.InputValue, new { id = "smsVerificationCode", @class = "nhsuk-input" })
        </div>
        <button class="button--next" id="nextScreen" type="submit" name="Question" value="Question">Next</button>
    }
    <br />
    @using (Html.BeginForm("GetSMSSecurityCode", "RegisterForSMS", FormMethod.Post, new { id = "resendCode" }))
    {
        @Html.Partial("_CommonHiddenFieldsOutcomeViewModel", Model)
        @Html.Partial("_CommonHiddenFieldsCareAdviceViewModel", Model)
        @Html.Partial("_commonHiddenFieldsSendsSMSViewModel", Model)
        @Html.HiddenFor(m => m.SelectedServiceId)
        <div class="nhsuk-u-margin-bottom-5"><span>Haven't got a code yet? </span><button type="submit" name="resendCode" id="resendCode" value="True" class="button--link" formnovalidate="formnovalidate">Resend code</button></div>
    }
</div>

@Html.Partial("_PageLoadingIndicator")

<script>
    $(document).on('submit', '#submitDetailsForm', function () {
        startPageLoadingIndicator('Sending your details...')
    })
</script>