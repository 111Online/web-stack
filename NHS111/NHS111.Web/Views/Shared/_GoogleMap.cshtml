@{var services = Model.GroupedDosServices.FirstOrDefault(s => s.OnlineDOSServiceType == OnlineDOSServiceType.GoTo).Services }

<div class="service-map" role="presentation"></div>

<script src="https://maps.google.com/maps/api/js?key=AIzaSyCv3YwvmRoueyoLcW2iiSPjVeHecU18hmA "
        type="text/javascript"></script>

<script src="/Scripts/geotools.js"
        type="text/javascript"></script>
<script type="text/javascript">

    var locations = [
        @{int i = 0; }
        @if (Model.DosCheckCapacitySummaryResult.Success != null)
        {
            foreach (var service in services)
            {
                @Html.Raw("['" + service.Name + "',OsGridRef.osGridToLatLon(new OsGridRef(" + service.Eastings + ", " + service.Northings + "), LatLon.datum.OSGB36).lat, OsGridRef.osGridToLatLon(new OsGridRef(" + service.Eastings + ", " + service.Northings + "), LatLon.datum.OSGB36).lon, " + i + "],");
                i++;
            }
        }
    ];

    function initialise() {
        var map = new google.maps.Map($('.service-map')[0],
            {
                zoom: 10,
                center: new google.maps.LatLng(locations[0][1], locations[0][2]),
                mapTypeId: google.maps.MapTypeId.ROADMAP
            });
        var infowindow = new google.maps.InfoWindow();
        var marker, i;

        for (i = 0; i < locations.length; i++) {
            var pointerNo = i + 1;
            marker = new google.maps.Marker({
                position: new google.maps.LatLng(locations[i][1], locations[i][2]),
                map: map
            });

            google.maps.event.trigger(map, "resize");

            google.maps.event.addListener(marker,
                'click',
                (function (marker, i) {
                    return function () {
                        infowindow.setContent(locations[i][0]);
                        infowindow.open(map, marker);
                    }
                })(marker, i));
        }
    }

    $("details:not([open])").has(".service-map").one("click", function () { initialise(); })
</script>